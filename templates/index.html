<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dự báo fouling E-1112</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">Dự báo số lượng tube fouling – E-1112</h1>

    {% if error_msg %}
        <div class="alert alert-danger">{{ error_msg }}</div>
    {% endif %}

    <div class="row">
        <!-- Nhập tay -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Nhập dữ liệu bằng tay</div>
                <div class="card-body">
                    <form method="post">
                        <input type="hidden" name="action" value="manual">
                        <div class="mb-2">
                            <label class="form-label">Nhiệt độ đầu vào (Tin)</label>
                            <input class="form-control" name="Tin" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Nhiệt độ đầu ra (Tout)</label>
                            <input class="form-control" name="Tout" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Độ mở van (%)</label>
                            <input class="form-control" name="Valve" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Công suất CDU</label>
                            <input class="form-control" name="CDU" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Lưu lượng</label>
                            <input class="form-control" name="Flow" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">DeltaT In–Out E1112</label>
                            <input class="form-control" name="DeltaT" type="number" step="0.01" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Độ ẩm (%)</label>
                            <input class="form-control" name="Humidity" type="number" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nhiệt độ môi trường (Tamb)</label>
                            <input class="form-control" name="Tamb" type="number" step="0.01" required>
                        </div>

                        <button class="btn btn-primary" type="submit">Dự báo fouling</button>
                    </form>
                </div>
            </div>

            {% if manual_result %}
            <div class="card mb-4">
                <div class="card-header">Kết quả dự báo (input tay)</div>
                <div class="card-body">
                    <ul class="list-group">
                        {% for k, v in manual_result.items() %}
                            <li class="list-group-item d-flex justify-content-between">
                                <span>{{ k }}</span>
                                <span><strong>{{ v }}</strong></span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Upload file -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">Upload file Excel/CSV</div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        <input type="hidden" name="action" value="file">
                        <div class="mb-3">
                            <label class="form-label">Chọn file (.xlsx hoặc .csv)</label>
                            <input class="form-control" type="file" name="file" required>
                        </div>
                        <button class="btn btn-success" type="submit">Chạy dự báo cho file</button>
                    </form>
                    {% if table_html %}
                        <hr>
                        <a href="/download" class="btn btn-outline-secondary mb-2">
                            Tải file kết quả (.xlsx)
                        </a>
                        <div class="mt-2" style="max-height: 400px; overflow:auto;">
                            {{ table_html|safe }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

</div>
</body>
</html>
